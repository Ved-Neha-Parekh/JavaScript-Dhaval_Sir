<!DOCTYPE html>
<html lang="en">

<head>
    <title>Movie API Project</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS v5.2.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
        body {
            background-color: #141414;
            color: white;
        }

        .movie-card {
            transition: transform 0.2s;
            cursor: pointer;
        }

        .movie-card:hover {
            transform: scale(1.05);
        }

        .movie-poster {
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-dark bg-dark px-4 justify-content-start">
        <a href="#" class="navbar-brand">üé¨ MovieApp</a>
        <select id="genreSelect" class="form-select me-3 border-0" style="width: 180px;">
            <option value="">All Genres</option>
        </select>
        <form class="d-flex" id="searchForm">
            <input type="search" class="form-control border-0 me-2" id="searchInput" />
            <button class="btn btn-danger" type="submit">Search</button>
        </form>
    </nav>

    <div class="container my-4">
        <h2 class="mb-4">Popular Movies</h2>
        <div class="row" id="movieList"></div>
    </div>
    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    <script>
        // const url = 'https://api.themoviedb.org/3/movie/popular?language=en-US&page=1';
        // const options = {
        //     method: 'GET',
        //     headers: {
        //         accept: 'application/json',
        //         Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJjMjY2NTRhNDgzNWM5Yjk4MTJkMTdjNmJlNGE3OTU2NCIsIm5iZiI6MTc1NzA0NDUzMi4zNjYwMDAyLCJzdWIiOiI2OGJhNWYzNDhkNzFjN2M4YjY4Y2UwMzkiLCJzY29wZXMiOlsiYXBpX3JlYWQiXSwidmVyc2lvbiI6MX0.wCFPKuXXWDCQqjpUp1jX-xDGK-haVn_RGN9rS9zEkdU'
        //     }
        // };

        // fetch(url, options)
        //     .then(res => res.json())
        //     .then(json => console.log(json))
        //     .catch(err => console.error(err));

        const API_KEY = "c26654a4835c9b9812d17c6be4a79564";
        const BASE_URL = "https://api.themoviedb.org/3";
        const IMG_URL = "https://image.tmdb.org/t/p/w500";

        const movieList = document.getElementById("movieList");
        const searchForm = document.getElementById("searchForm");
        const searchInput = document.getElementById("searchInput");
        const genreSelect = document.getElementById("genreSelect");

        async function getGenre() {
            const response = await fetch(`${BASE_URL}/genre/movie/list?api_key=${API_KEY}&language=en-US`);
            const data = await response.json();
            data.genres.forEach(genre => {
                const option = document.createElement("option");
                option.value = genre.id;
                option.textContent = genre.name;
                genreSelect.appendChild(option);
            })
        }


        async function getPopularMovies(genreId = "") {
            let url = `${BASE_URL}/movie/popular?api_key=${API_KEY}&language=en-US&page=1`;
            if (genreId) {
                url = `${BASE_URL}/discover/movie?api_key=${API_KEY}&language=en-US&with_genres=${genreId}`;
            }
            const response = await fetch(url);
            const data = await response.json();
            showMovies(data.results);
        }

        genreSelect.addEventListener("change", () => {
            const genreId = genreSelect.value;
            getPopularMovies(genreId);
        });

        function showMovies(movies) {
            movieList.innerHTML = "";
            movies.forEach((movie) => {
                const col = document.createElement("div");
                col.classList.add("col-md-3", "mb-4");
                col.innerHTML = `
                <div class="card bg-dark text-white movie-card ">
                        <img src="${movie.poster_path
                        ? IMG_URL + movie.poster_path
                        : "./images.jpeg"
                    }" class="card-img-top movie-poster" alt="${movie.title}" />
                        <div class="card-body">
                        <h5 class="card-title">${movie.title}</h5>
                        <p class="card-text">‚≠ê ${movie.vote_average.toFixed(1)}</p>
                    </div>
                 </div>
                `;

                movieList.appendChild(col);
            });
        }

        async function searchMovies(query) {
            const response = await fetch(`${BASE_URL}/search/movie?api_key=${API_KEY}&query=${query}`)
            const data = await response.json();
            showMovies(data.results);
        }

        searchForm.addEventListener("submit", (e => {
            e.preventDefault();
            const query = searchInput.value;
            console.log(query);
            if (query) {
                searchMovies(query)
            } else {
                getPopularMovies();
            }
        }))
        getPopularMovies();
        getGenre();
    </script>
</body>

</html>